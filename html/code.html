<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online Judge T√πy Bi·∫øn</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 30px;
      max-width: 1000px;
      width: 100%;
    }
    textarea, input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: monospace;
      font-size: 1em;
      box-sizing: border-box;
    }
    textarea#userCode { /* Specific style for code editor */
        font-family: 'Fira Code', 'Cascadia Code', 'Consolas', 'Monaco', monospace;
        font-size: 1.1em;
        height: 350px;
        resize: vertical;
    }
    textarea#description, textarea#sampleInput, textarea#expectedOutput {
        font-family: "Segoe UI", sans-serif; /* Keep problem description in a readable font */
        font-size: 1em;
        resize: vertical;
    }
    label {
      font-weight: 600;
      color: #333;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background: #0056b3;
    }
    .output {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      white-space: pre-wrap;
      font-family: monospace;
      color: #212529;
      margin-top: 20px;
    }
    .output.error { /* Style for error output */
        background-color: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }
    /* Add a basic syntax highlight like feel by monospace font for code areas */
    code {
        background-color: #e9ecef;
        padding: 2px 4px;
        border-radius: 4px;
        font-family: 'Fira Code', 'Cascadia Code', 'Consolas', 'Monaco', monospace;
    }
    .status-message {
        font-weight: bold;
        margin-bottom: 10px;
    }
    .status-message.success {
        color: #28a745; /* Green */
    }
    .status-message.fail {
        color: #dc3545; /* Red */
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Online Judge - T·ª± t·∫°o ƒë·ªÅ</h1>

  <label for="description">üìù M√¥ t·∫£ ƒë·ªÅ b√†i:</label>
  <textarea id="description" rows="4" placeholder="V√≠ d·ª•: Vi·∫øt h√†m t√≠nh t·ªïng hai s·ªë nguy√™n A, B. H√†m nh·∫≠n v√†o 2 s·ªë nguy√™n v√† tr·∫£ v·ªÅ t·ªïng c·ªßa ch√∫ng."></textarea>

  <label for="sampleInput">üî¢ Input m·∫´u:</label>
  <textarea id="sampleInput" rows="2" placeholder="V√≠ d·ª•: 5 7"></textarea>

  <label for="expectedOutput">‚úÖ Output m·∫´u mong mu·ªën:</label>
  <textarea id="expectedOutput" rows="2" placeholder="V√≠ d·ª•: 12"></textarea>

  <label for="language">üíª Ng√¥n ng·ªØ l·∫≠p tr√¨nh:</label>
  <select id="language">
    <option value="python">Python</option>
    <option value="cpp">C++</option>
    <option value="java">Java</option>
  </select>

  <label for="userCode">üß† Vi·∫øt m√£ c·ªßa b·∫°n:</label>
  <textarea id="userCode" rows="12" placeholder="Vi·∫øt code t·∫°i ƒë√¢y..."></textarea>

  <button onclick="submitCode()">N·ªôp b√†i</button>

  <div class="output" id="outputArea">
    ‚è≥ Ch∆∞a c√≥ k·∫øt qu·∫£...
  </div>
</div>

<script>
  async function submitCode() {
    const description = document.getElementById("description").value.trim();
    const sampleInput = document.getElementById("sampleInput").value.trim();
    const expectedOutput = document.getElementById("expectedOutput").value.trim();
    const userCode = document.getElementById("userCode").value.trim();
    const language = document.getElementById("language").value;
    const outputDiv = document.getElementById("outputArea");

    // Clear previous output and set loading state
    outputDiv.textContent = "‚è≥ ƒêang ch·∫•m b√†i v√† l·∫•y nh·∫≠n x√©t AI...";
    outputDiv.classList.remove('error'); // Ensure error styling is removed

    if (!description || !sampleInput || !expectedOutput || !userCode) {
      outputDiv.textContent = "‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß m√¥ t·∫£ ƒë·ªÅ b√†i, input/output m·∫´u v√† m√£ c·ªßa b·∫°n.";
      outputDiv.classList.add('error');
      return;
    }

    try {
      // --- Ph·∫ßn 1: M√¥ ph·ªèng ch·∫•m ƒëi·ªÉm (trong th·ª±c t·∫ø s·∫Ω l√† g·ªçi API backend c·ªßa b·∫°n) ---
      // Trong m·ªôt h·ªá th·ªëng th·ª±c t·∫ø, b·∫°n s·∫Ω g·ª≠i userCode, language, v√† sampleInput
      // ƒë·∫øn server backend c·ªßa m√¨nh ƒë·ªÉ ch·∫°y code v√† nh·∫≠n k·∫øt qu·∫£ th·ª±c t·∫ø.
      // D∆∞·ªõi ƒë√¢y l√† m√¥ ph·ªèng ƒë·ªÉ c√≥ d·ªØ li·ªáu cho AI.

      let simulatedScore;
      let actualOutput;
      let compilationError = '';
      let runtimeError = '';
      let executionTime = (Math.random() * 0.5 + 0.1).toFixed(3); // 0.1s to 0.6s

      // Simulate different scenarios for demonstration
      const scenario = Math.random();

      if (scenario < 0.2) { // Simulate Compilation Error
          simulatedScore = 0;
          compilationError = `L·ªói c√∫ ph√°p: Code c·ªßa b·∫°n kh√¥ng th·ªÉ bi√™n d·ªãch/th√¥ng d·ªãch ƒë∆∞·ª£c. H√£y ki·ªÉm tra l·∫°i c·∫•u tr√∫c v√† c√∫ ph√°p c·ªßa ${language}.`;
          actualOutput = "Kh√¥ng th·ªÉ ch·∫°y do l·ªói bi√™n d·ªãch.";
      } else if (scenario < 0.4) { // Simulate Runtime Error (e.g., division by zero, infinite loop)
          simulatedScore = Math.floor(Math.random() * 30); // Low score
          runtimeError = `L·ªói th·ªùi gian ch·∫°y: Ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n ƒë√£ g·∫∑p l·ªói trong qu√° tr√¨nh th·ª±c thi, v√≠ d·ª• nh∆∞ chia cho 0, truy c·∫≠p ngo√†i gi·ªõi h·∫°n m·∫£ng, ho·∫∑c v√≤ng l·∫∑p v√¥ h·∫°n.`;
          actualOutput = "L·ªói trong qu√° tr√¨nh ch·∫°y.";
      } else if (scenario < 0.7) { // Simulate Incorrect Output (Wrong Answer)
          simulatedScore = Math.floor(30 + Math.random() * 40); // Moderate score
          actualOutput = `Output kh√¥ng ƒë√∫ng: K·∫øt qu·∫£ c·ªßa b·∫°n l√† "sai_output_cua_ban" (thay v√¨ "${expectedOutput}")`; // Simulate wrong output
      } else { // Simulate Accepted (Correct Output)
          simulatedScore = Math.floor(80 + Math.random() * 20); // High score
          actualOutput = expectedOutput; // Match expected output
      }

      // --- Ph·∫ßn 2: G·ª≠i y√™u c·∫ßu l·∫•y nh·∫≠n x√©t AI ---
      // Chu·∫©n b·ªã URL API AI
      const aiApiUrl = new URL('https://code.techmax.site/system/getai.php');
      aiApiUrl.searchParams.append('code', userCode);
      aiApiUrl.searchParams.append('language', language);
      aiApiUrl.searchParams.append('score', simulatedScore);
      aiApiUrl.searchParams.append('problem_description', description); // G·ª≠i m√¥ t·∫£ ƒë·ªÅ b√†i
      aiApiUrl.searchParams.append('sample_input', sampleInput);       // G·ª≠i input m·∫´u
      aiApiUrl.searchParams.append('expected_output', expectedOutput); // G·ª≠i output mong mu·ªën
      aiApiUrl.searchParams.append('actual_output', actualOutput);     // G·ª≠i output th·ª±c t·∫ø (t·ª´ b∆∞·ªõc ch·∫•m ƒëi·ªÉm)
      aiApiUrl.searchParams.append('compilation_error', compilationError); // G·ª≠i l·ªói bi√™n d·ªãch
      aiApiUrl.searchParams.append('runtime_error', runtimeError);     // G·ª≠i l·ªói runtime

      console.log('Fetching AI feedback from:', aiApiUrl.toString());

      const aiResponse = await fetch(aiApiUrl.toString(), { method: 'GET' });

      if (!aiResponse.ok) {
        throw new Error(`L·ªói HTTP khi l·∫•y nh·∫≠n x√©t AI! Status: ${aiResponse.status}`);
      }

      const aiData = await aiResponse.json();
      console.log('AI API Response:', aiData);

      let aiFeedback = 'Kh√¥ng c√≥ nh·∫≠n x√©t t·ª´ AI ho·∫∑c ƒë·ªãnh d·∫°ng kh√¥ng h·ª£p l·ªá.';
      if (aiData && aiData.feedback) {
        aiFeedback = aiData.feedback;
      }

      // --- C·∫≠p nh·∫≠t giao di·ªán ng∆∞·ªùi d√πng ---
      let statusMessage = '';
      let statusClass = '';

      if (simulatedScore >= 80 && !compilationError && !runtimeError) {
          statusMessage = '‚úÖ B√†i l√†m xu·∫•t s·∫Øc! üéâ';
          statusClass = 'success';
      } else if (simulatedScore >= 50 && !compilationError && !runtimeError) {
          statusMessage = 'üëç B√†i l√†m kh√° t·ªët, c√≥ th·ªÉ c·∫ßn c·∫£i thi·ªán th√™m! ';
          statusClass = 'success';
      } else {
          statusMessage = '‚ùå B√†i l√†m ch∆∞a ƒë·∫°t. Vui l√≤ng xem nh·∫≠n x√©t ƒë·ªÉ c·∫£i thi·ªán. üò¢';
          statusClass = 'fail';
      }

      outputDiv.innerHTML = `
        <p class="status-message ${statusClass}">${statusMessage}</p>
        <p>üßÆ <b>ƒêi·ªÉm: ${simulatedScore}/100</b></p>
        <p>‚è≥ Th·ªùi gian ch·∫°y m√¥ ph·ªèng: ${executionTime} gi√¢y</p>
        <p>üìã Nh·∫≠n x√©t t·ª´ AI:</p>
        <div class="output-box">${aiFeedback}</div>
        <p>üíª M√£ c·ªßa b·∫°n:</p>
        <pre><code>${userCode}</code></pre>
        <p>üî¢ Input m·∫´u:</p>
        <pre><code>${sampleInput}</code></pre>
        <p>‚úÖ Output mong mu·ªën:</p>
        <pre><code>${expectedOutput}</code></pre>
        <p>üßæ Output th·ª±c t·∫ø (m√¥ ph·ªèng):</p>
        <pre><code>${actualOutput}</code></pre>
      `;

      if (compilationError) {
          outputDiv.innerHTML += `<p class="status-message fail">L·ªói bi√™n d·ªãch:</p><pre class="output error"><code>${compilationError}</code></pre>`;
          outputDiv.classList.add('error');
      }
      if (runtimeError) {
          outputDiv.innerHTML += `<p class="status-message fail">L·ªói th·ªùi gian ch·∫°y:</p><pre class="output error"><code>${runtimeError}</code></code</pre>`;
          outputDiv.classList.add('error');
      }


    } catch (error) {
      console.error('L·ªói khi ch·∫•m b√†i ho·∫∑c l·∫•y nh·∫≠n x√©t AI:', error);
      outputDiv.textContent = `‚ùå ƒê√£ x·∫£y ra l·ªói: ${error.message}. Vui l√≤ng th·ª≠ l·∫°i.`;
      outputDiv.classList.add('error');
    }
  }
</script>
</body>
</html>